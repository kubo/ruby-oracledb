<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: OracleDB::Soda::Db
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "OracleDB::Soda::Db";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (D)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../OracleDB.html" title="OracleDB (module)">OracleDB</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Soda.html" title="OracleDB::Soda (module)">Soda</a></span></span>
     &raquo; 
    <span class="title">Db</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: OracleDB::Soda::Db
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OracleDB::Soda::Db</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>ext/oracledb/rboradb_soda.c</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collection_names-instance_method" title="#collection_names (instance method)">#<strong>collection_names</strong>(*args)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collections-instance_method" title="#collections (instance method)">#<strong>collections</strong>(*args)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_collection-instance_method" title="#create_collection (instance method)">#<strong>create_collection</strong>(*args)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_document-instance_method" title="#create_document (instance method)">#<strong>create_document</strong>(key, content, media_type)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(*args)  &#x21d2; Object </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open_collection-instance_method" title="#open_collection (instance method)">#<strong>open_collection</strong>(name)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(*args)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="OracleDB::Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/oracledb/rboradb.c', line 121</span>

VALUE rboradb_notimplement(int argc, VALUE *argv, VALUE self)
{
    rb_notimplement();
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="collection_names-instance_method">
  
    #<strong>collection_names</strong>(*args)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="OracleDB::Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/oracledb/rboradb_soda.c', line 499</span>

static VALUE soda_db_collection_names(int argc, VALUE *argv, VALUE self)
{
    SodaDb_t *db = To_SodaDb(self);
    dpiSodaCollNames names;
    VALUE start_name, kwopts, limit;
    VALUE ary;
    uint32_t idx;
    static ID keywords[1];

    if (!keywords[0]) {
        keywords[0] = rb_intern_const(&quot;limit&quot;);
    }
    rb_scan_args(argc, argv, &quot;01:&quot;, &amp;start_name, &amp;kwopts);
    rb_get_kwargs(kwopts, keywords, 0, 1, &amp;limit);

    OptExportString(start_name);
    if (limit == Qundef) {
        limit = INT2FIX(0);
    }
    if (dpiSodaDb_getCollectionNames(db-&gt;handle, OPT_RSTRING_PTR(start_name), OPT_RSTRING_LEN(start_name), NUM2UINT(limit), 0, &amp;names) != DPI_SUCCESS) {
        RBORADB_RAISE_ERROR(db);
    }
    ary = rb_ary_new_capa(names.numNames);
    for (idx = 0; idx &lt; names.numNames; idx++) {
        rb_ary_push(ary, rb_enc_str_new(names.names[idx], names.nameLengths[idx], rb_utf8_encoding()));
    }
    dpiSodaDb_freeCollectionNames(db-&gt;handle, &amp;names);
    return ary;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="collections-instance_method">
  
    #<strong>collections</strong>(*args)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="OracleDB::Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/oracledb/rboradb_soda.c', line 475</span>

static VALUE soda_db_collections(int argc, VALUE *argv, VALUE self)
{
    SodaDb_t *db = To_SodaDb(self);
    VALUE start_name;
    SodaCollCursor_t cursor;
    int state;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;start_name);

    RETURN_ENUMERATOR(self, 0, 0);
    OptExportString(start_name);
    if (dpiSodaDb_getCollections(db-&gt;handle, OPT_RSTRING_PTR(start_name), OPT_RSTRING_LEN(start_name), 0, &amp;cursor.handle) != DPI_SUCCESS) {
        RBORADB_RAISE_ERROR(db);
    }
    cursor.dconn = db-&gt;dconn;
    cursor.proc = rb_block_proc();
    rb_protect(iter_coll_cursor, (VALUE)&amp;cursor, &amp;state);
    dpiSodaCollCursor_release(cursor.handle);
    if (state) {
        rb_jump_tag(state);
    }
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_collection-instance_method">
  
    #<strong>create_collection</strong>(*args)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="OracleDB::Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/oracledb/rboradb_soda.c', line 412</span>

static VALUE soda_db_create_collection(int argc, VALUE *argv, VALUE self)
{
    SodaDb_t *db = To_SodaDb(self);
    VALUE name, kwopts, metadata, map;
    uint32_t flags;
    dpiSodaColl *handle;
    static ID keywords[1];

    if (!keywords[0]) {
        keywords[0] = rb_intern_const(&quot;map&quot;);
    }
    rb_scan_args(argc, argv, &quot;20:&quot;, &amp;name, &amp;metadata, &amp;kwopts);
    rb_get_kwargs(kwopts, keywords, 0, 1, &amp;map);

    ExportString(name);
    ExportString(metadata);
    flags = (map != Qundef &amp;&amp; RTEST(map)) ? DPI_SODA_FLAGS_CREATE_COLL_MAP : 0;
    if (dpiSodaDb_createCollection(db-&gt;handle, RSTRING_PTR(name), RSTRING_LEN(name),
        RSTRING_PTR(metadata), RSTRING_LEN(metadata), flags, &amp;handle) != DPI_SUCCESS) {
        RBORADB_RAISE_ERROR(db);
    }
    return soda_coll_new(handle, db-&gt;dconn);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_document-instance_method">
  
    #<strong>create_document</strong>(key, content, media_type)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="OracleDB::Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/oracledb/rboradb_soda.c', line 436</span>

static VALUE soda_db_create_document(VALUE self, VALUE key, VALUE content, VALUE media_type)
{
    SodaDb_t *db = To_SodaDb(self);
    dpiSodaDoc *handle;
    static const char *application_json = &quot;application/json&quot;;
    const size_t application_json_len = strlen(application_json);

    OptExportString(key);
    SafeStringValue(content);
    OptExportString(media_type);
    if (NIL_P(media_type) || (RSTRING_LEN(media_type) == application_json_len &amp;&amp; memcmp(RSTRING_PTR(media_type), application_json, application_json_len) == 0)) {
        content = rb_str_export_to_enc(content, rb_utf8_encoding());
    }
    if (dpiSodaDb_createDocument(db-&gt;handle, OPT_RSTRING_PTR(key), OPT_RSTRING_LEN(key),
        RSTRING_PTR(content), RSTRING_LEN(content), OPT_RSTRING_PTR(media_type), OPT_RSTRING_LEN(media_type), 0, &amp;handle) != DPI_SUCCESS) {
        RBORADB_RAISE_ERROR(db);
    }
    return soda_doc_new(handle, db-&gt;dconn);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open_collection-instance_method">
  
    #<strong>open_collection</strong>(name)  &#x21d2; <tt><span class='object_link'><a href="../Object.html" title="OracleDB::Object (class)">Object</a></span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


529
530
531
532
533
534
535
536
537
538
539</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/oracledb/rboradb_soda.c', line 529</span>

static VALUE soda_db_open_collection(VALUE self, VALUE name)
{
    SodaDb_t *db = To_SodaDb(self);
    dpiSodaColl *handle;

    ExportString(name);
    if (dpiSodaDb_openCollection(db-&gt;handle, RSTRING_PTR(name), RSTRING_LEN(name), 0, &amp;handle) != DPI_SUCCESS) {
        RBORADB_RAISE_ERROR(db);
    }
    return soda_coll_new(handle, db-&gt;dconn);
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Sep  4 04:43:57 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-3.0.2).
</div>

    </div>
  </body>
</html>